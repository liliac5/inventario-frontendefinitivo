<div class="page-container asignacion-container">
  <app-sidebar></app-sidebar>

  <div class="main-content">
    <div class="header">
      <h1 class="welcome">¡Bienvenido/a, <span class="user-name">{{ currentUser }}</span>!</h1>
    </div>

    <div class="content-area">
      <h2 class="page-title">ASIGNACION DE AULA</h2>

      <div class="form-container">
        <!-- Formulario de Asignación -->
        <div class="form-section">
          <div class="section-header">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="section-icon">
              <path d="M10 10C12.7614 10 15 7.76142 15 5C15 2.23858 12.7614 0 10 0C7.23858 0 5 2.23858 5 5C5 7.76142 7.23858 10 10 10Z" fill="currentColor"/>
              <path d="M10 12C5.58172 12 2 15.5817 2 20H18C18 15.5817 14.4183 12 10 12Z" fill="currentColor"/>
            </svg>
            <h3 class="section-title">Nueva Asignación de Aula</h3>
          </div>
          
          <div class="form-fields">
            <div class="form-field">
              <label>Usuario *</label>
              <select [(ngModel)]="nuevoUsuarioId" class="form-input" required>
  <option [ngValue]="null">Seleccione un usuario</option>
  <option *ngFor="let usuario of usuarios" [ngValue]="usuario.idUsuario">
    {{ usuario.nombre }} ({{ usuario.email }})
  </option>
</select>
            </div>
            
            <div class="form-field">
              <label>Aula *</label>
              <select [(ngModel)]="nuevaAulaId" class="form-input" required>
                <option [ngValue]="null">Seleccione un aula</option>
                <option *ngFor="let aula of getAulasDisponibles()" [ngValue]="aula.idAula">
                  {{ aula.nombre }} - {{ aula.ubicacion }} (Capacidad: {{ aula.capacidad }})
                </option>
              </select>
            </div>

            <div class="form-field">
              <label>Fecha de asignacion</label>
              <input 
                type="date" 
                [value]="fechaHoy"
                class="form-input"
                readonly
                disabled>
            </div>
          </div>
        </div>
      </div>

      <!-- Botón Registrar -->
      <div class="action-button-container">
        <button class="btn-registrar" (click)="registrarAsignacion()">
          Registrar Asignación
        </button>
      </div>
<!-- ALERTA MODERNA -->
<div class="alert-overlay" *ngIf="mostrarAlerta">
  <div class="alert-box" [ngClass]="tipoAlerta">

    <div class="alert-icon">
      {{ tipoAlerta === 'success' ? '✓' : '!' }}
    </div>

    <h3>{{ tituloAlerta }}</h3>
    <p>{{ mensajeAlerta }}</p>

    <button class="btn-alert" (click)="mostrarAlerta = false">
      Entendido
    </button>

  </div>
</div>


      <!-- Lista de Asignaciones -->
      <div class="asignaciones-list" *ngIf="asignaciones.length > 0">
        <h3 class="list-title">Asignaciones Existentes</h3>
        <div class="table-container">
          <table class="asignaciones-table">
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Aula</th>
                <th>Fecha asignacion</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
           <tbody>
  <tr *ngFor="let asignacion of asignaciones">
    <td>{{ asignacion.usuario.nombre }}</td>
    <td>{{ asignacion.aula.nombre }} - {{ asignacion.aula.ubicacion }}</td>
<td>
  {{ asignacion.fechaSolicitud | date:'dd/MM/yyyy' }}
</td>


    <td>
      <span 
        class="status-badge"
        [class.active]="asignacion.estado"
        [class.inactive]="!asignacion.estado">
        {{ asignacion.estado ? 'Activa' : 'Inactiva' }}
      </span>
    </td>
    <td class="actions">
      <button class="btn-edit" (click)="openEditModal(asignacion)" title="Editar">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M18.5 2.50023C18.8978 2.10243 19.4374 1.87891 20 1.87891C20.5626 1.87891 21.1022 2.10243 21.5 2.50023C21.8978 2.89804 22.1213 3.43762 22.1213 4.00023C22.1213 4.56284 21.8978 5.10243 21.5 5.50023L12 15.0002L8 16.0002L9 12.0002L18.5 2.50023Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="btn-delete" (click)="eliminarAsignacion(asignacion.idAsignacion)" title="Eliminar">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </td>
  </tr>
</tbody>

          </table>
        </div>
      </div>
    </div>
  </div>
</div>



<div class="modal-overlay" *ngIf="showEditModal">
  <div class="modal-content">

    <h2>Editar Asignación</h2>

    <div class="form-field">
      <label>Usuario</label>
      <select [(ngModel)]="editUsuarioId">
        <option *ngFor="let usuario of usuarios"
                [value]="usuario.idUsuario">
          {{ usuario.nombre }}
        </option>
      </select>
    </div>

<div class="form-field">
  <label>Aula</label>
  <select [(ngModel)]="editAulaId">
    <option *ngFor="let aula of getAulasDisponiblesParaEditar()"
            [value]="aula.idAula">
      {{ aula.nombre }} - {{ aula.ubicacion }}
    </option>
  </select>
</div>


    <div class="form-field">
      <label>Fecha</label>
      <input
  type="date"
  [value]="fechaHoy"
  name="editFecha"
  readonly
  disabled>
    </div>

    <div class="modal-actions">
      <button class="btn-save" (click)="updateAsignacion()">
        Guardar
      </button>
      <button class="btn-cancel" (click)="closeEditModal()">
        Cancelar
      </button>
    </div>

  </div>
</div>


