<div class="reportes-container">
  <app-sidebar></app-sidebar>
  
  <div class="main-content">
    <div class="header">
      <h1 class="welcome">¡Bienvenido/a, <span class="user-name">{{ currentUser }}</span>!</h1>
    </div>

    <div class="content-area">
      <div class="filter-buttons">
        <button 
          class="filter-btn" 
          [class.active]="selectedFilter === 'TODOS'"
          (click)="selectFilter('TODOS')">
          TODOS
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedFilter === 'EN REPARACION'"
          (click)="selectFilter('EN REPARACION')">
          EN REPARACION
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedFilter === 'PENDIENTE'"
          (click)="selectFilter('PENDIENTE')">
          PENDIENTE
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedFilter === 'RESUELTOS'"
          (click)="selectFilter('RESUELTOS')">
          RESUELTOS
        </button>
      </div>

      <div class="table-container">
        <table class="reportes-table">
          <thead>
            <tr>
              <th>ESTADO</th>
              <th>ELEMENTO AFECTADO</th>
              <th>TIPO DE INCIDENCIA</th>
              <th>REPORTADO POR</th>
              <th>FECHA/HORA</th>
              <th>DETALLE DEL PROBLEMA</th>
              <th>ACCIONES</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let reporte of filteredReportes">
              <td>
                <div class="status-cell">
                  <span class="status-dot" 
                        [class.reparacion]="getEstadoClass(reporte.estado) === 'reparacion'"
                        [class.pendiente]="getEstadoClass(reporte.estado) === 'pendiente'"
                        [class.resuelto]="getEstadoClass(reporte.estado) === 'resuelto'">
                  </span>
                  <span class="status-text">{{ reporte.estado }}</span>
                </div>
              </td>
              <td>{{ reporte.elementoAfectado }}</td>
              <td>{{ reporte.tipoIncidencia }}</td>
              <td>{{ reporte.reportadoPor }}</td>
              <td>{{ formatFechaHora(reporte.fechaHora) }}</td>
              <td>{{ reporte.detalleProblema }}</td>
              <td>
                <button class="view-link" (click)="viewDetails(reporte)">Ver</button>
              </td>
            </tr>
            <tr *ngIf="filteredReportes.length === 0">
              <td colspan="7" class="no-data">No hay reportes registrados</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal Detalles de Incidencia -->
<div class="modal-overlay" *ngIf="showDetailModal" (click)="closeDetailModal()">
  <div class="modal-content detail-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeDetailModal()">×</button>
    <h2 class="modal-title">Detalles de Incidencia #{{ selectedReporte?.idReporte || selectedReporte?.id_reporte || 'N/A' }}</h2>
    
    <div class="detail-content" *ngIf="selectedReporte">
      <div class="detail-row">
        <span class="detail-label">Estado:</span>
        <select [(ngModel)]="selectedReporte.estado" 
                name="estadoSelect"
                class="estado-select">
          <option value="PENDIENTE">PENDIENTE</option>
          <option value="EN REPARACIÓN">EN REPARACIÓN</option>
          <option value="RESUELTO">RESUELTO</option>
        </select>
      </div>
      
      <div class="detail-row">
        <span class="detail-label">Elemento Afectado:</span>
        <span class="detail-value">{{ selectedReporte.elementoAfectado }}</span>
      </div>
      
      <div class="detail-row">
        <span class="detail-label">Tipo de Incidencia:</span>
        <span class="detail-value">{{ selectedReporte.tipoIncidencia }}</span>
      </div>
      
      <div class="detail-row">
        <span class="detail-label">Reportado Por:</span>
        <span class="detail-value">{{ selectedReporte.reportadoPor }}</span>
      </div>
      
      <div class="detail-row">
        <span class="detail-label">Fecha/Hora:</span>
        <span class="detail-value">{{ formatFechaHora(selectedReporte.fechaHora) }}</span>
      </div>
      
      <div class="detail-row full-width">
        <span class="detail-label">Detalle del Problema:</span>
        <p class="detail-text">{{ selectedReporte.detalleProblema }}</p>
      </div>
    </div>
    
    <div class="modal-actions">
      <button type="button" class="btn-save-estado" (click)="updateReporteEstado(selectedReporte!, selectedReporte!.estado)">
        Guardar Cambios
      </button>
      <button type="button" class="btn-close-modal" (click)="closeDetailModal()">Cerrar</button>
    </div>
  </div>
</div>

